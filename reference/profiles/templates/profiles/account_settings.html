{% extends "base.html" %}
{% load static %}

{% block title %}Account Settings | Vacathon{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/profiles.css' %}">
{% endblock %}

{% block content %}
<section class="page-header layout-section layout-section--compact">
    <h1>Account Settings</h1>
    <p>Manage your personal information, login credentials, and achievements.</p>
</section>

<div class="settings-grid layout-section layout-surface" data-achievement-endpoint="{% url 'profiles:achievements' %}">
    <section>
        <h2>Profile Information</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="profile">
            {% for field in profile_form %}
            <div class="field">
                {{ field.label_tag }}
                {{ field }}
                {{ field.errors }}
            </div>
            {% endfor %}
            <button class="btn primary" type="submit">Update profile</button>
        </form>
    </section>

    <section>
        <h2>Account Details</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="account">
            {% for field in account_form %}
            <div class="field">
                {{ field.label_tag }}
                {{ field }}
                {{ field.errors }}
            </div>
            {% endfor %}
            <button class="btn primary" type="submit">Update account</button>
        </form>

        <h2>Change Password</h2>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="password">
            {% for field in password_form %}
            <div class="field">
                {{ field.label_tag }}
                {{ field }}
                {{ field.errors }}
            </div>
            {% endfor %}
            <button class="btn secondary" type="submit">Update password</button>
        </form>
    </section>

    <section class="achievements-manage">
        <h2>Achievements</h2>
        <form id="achievement-settings-form">
            {% csrf_token %}
            <div class="inline-fields">
                <label>
                    Title
                    <input class="control" type="text" name="title" required>
                </label>
                <label>
                    Achieved on
                    <input class="control" type="date" name="achieved_on">
                </label>
            </div>
            <label>
                Description
                <textarea class="control" name="description" rows="3"></textarea>
            </label>
            <label>
                Link
                <input class="control" type="url" name="link" placeholder="https://">
            </label>
            <div class="actions">
                <button class="btn primary" type="submit">Add achievement</button>
            </div>
        </form>

        <ul class="achievement-list" data-achievement-list>
            {% for achievement in achievements %}
            <li data-achievement-id="{{ achievement.id }}">
                <div>
                    <h3>{{ achievement.title }}</h3>
                    {% if achievement.achieved_on %}
                    <span class="meta">{{ achievement.achieved_on|date:"M j, Y" }}</span>
                    {% endif %}
                    <p>{{ achievement.description }}</p>
                </div>
                <button class="link-button" data-delete-achievement type="button"
                        data-delete-url="{% url 'profiles:achievement-delete' achievement.id %}">Remove</button>
            </li>
            {% empty %}
            <li>No achievements yet.</li>
            {% endfor %}
        </ul>
    </section>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/profiles.js' %}"></script>
{% endblock %}
